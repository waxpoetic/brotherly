language: ruby
rvm: 2.6.2
env:
  global:
  - COMPOSE_FILE=docker-compose.yml:docker-compose.test.yml
  - secure: Z2ttryjkg3gKr94PSwfQOBIotB2QGyB4NKBgboK2zRrRhdcrgqi1KT1Vkc2Hyn7DVuSMj7BWJBEN+98opkrgc/oqKiM5nS31pKy56f4vTxDwEmM8EiXnEi8ncazgu6fXkxf8zAjbEVcUEX4fp52MYn3Ct9ZonEcz281qOVYOShB8oaH6+YwQzUdx8mXPTLtTIN5QMhs+kzDug1t2DvJ0epMhOR5VyOnJMWtrEuvRNAhkh5pkDotcVokm82pj31uy+cfFa4LCXTU28FbV4QvJSJTvdI7CJORs5togBHiCjEMAyGPr59QjrV5lsi5anmvlF0N7/9UAhlGXMcDLEvLgCTAwGlSlEIXRaM7LFxiRuc3fJNdyxXKvQlsR+LcegoXO7/mG5zPI9wh7zLhGe1P5gret9LWxNeLHHZTRVCpnKcAkIrQnp70K7brNFO7B/mdbof22TabtgLfaMX7NxQlt3QBKy9ZGya3sbm7BjRfX5VZWI9UjuUwBkf30Xdf3vQtZLHbqW81WfmDR8F+V35VvB2RqKIITNSW6b8Up0XUuwnPo92SnkvpbIaUtNpt06swQRADCV2KoEStUnou77xyfJTZNdlH0qZ+4HrRzOND+QRZw4r+cht2xcl7Pxf/1C8fO/GScKnwC5WK2m83Rkeu+MEAO2HQSuaBEUpW7QvIOWJc=
  - secure: H6RzEBTRfG2AbcJPePZtTp18vsYBH82PIaJJM31kyt7ACYLE7yhcluUa7JN8B9BUptplDDJnlQSZ+RA9xiOw5SM3racWUO9HRXN/dPoYet+6FeZV+/NdX1hzVaMy1Giq9sf9/u93Fv7XLudLzFunyMpp5WOWUvUSeo+gilRFlJr+PnSiDG80eZJ+Ke7hehWXzBFR+6R7EHeyRDMWk4amV6Ubb5UMG4+nWXwLIib0v6lmXHomvgtKwlath5MS1JkJ94PG5gfd1gpO7DjBMRe3yYCa7fccW60V4B+tm/hQ4pXu/u67IACSWMeF1ip7G2Zth+tyErgJ8EYOFQ7Ub0jXq+FYNDWs+ntN7sSX+ocgrKeB0Z35E/lDPMfrpFiAkxi8IMgMND+A4hlHbTPksc0QfvO0L8SVYiit9UDrafa6lvxKhdxz6EsLI2EAPRMXzkhIrGYgE70FhWx0ds9vS7sPSH3J3c9DIQo5Za512nwuHjrWWgwF0wpXxfCCLfB9cy17UbWruzpb6xciat7pfGnqb7MWLAQBkE8zraqUSuGuiJlYk43kjkIeQ88yZ1rKiedIZLMT256HJqOw50qbxpkXgbaVwYPkYo9nq0Nn4VhloVOgaQOIociYrsxM6szvgLBvBydyVu9bhqbp+kgTY4Rpqu92Ot+d0+0iwrCR0cgipXA=
  - secure: Zx8iE+smox85fLfw6UKHE1a+UXDCVssPFKAKMwWxV/03b8KdLUdx2CXzG+4rb9Vn9Pu8QMZx/jxyvBVoPHjoqxcC/v0tNNCORDcFd6PxlzMcWL2np9gIh3U07hAjhTb4uYrxB2SjhpQDD1dovpGamPWIzvJxfaS5K/6whCsR0MGyXMoyhdL4L0jD/4cTGosmIY6jz7DCMPcuek2VsnNcqenwFYaxgXA/GdVphHNzhOXp3MVy/4PZl6Lg07H/ZyJddC2aHFDj9ypPfE/8E1yWyii99RQRXJz86desrsAw3+HJs2jtfkP28YeA8usmaDVFdP4s3ZpUnmg8Hvdxw/B22D9PNcjOwmWDrjq6wNbwMN6O2rhBsUV6cdDI90u/GjlcTO4whr65LUTmjg5/5Fqoh/osoS5QuQ7tUaOAa9zZ0z5UKZ3iThFGi1KJwL+KYLkyrf1UnY2MpQdPv2rk6zOgWhCoxuFv6RVKXFUsf+9/74Pgl//T0rCAXZlv97LNCkzwjOXq0H6+5egW0IrGws/YOFVVTYZQYEXjmFyV2TlAfhwjdvbjSI1/bgzg/WuYd7zKyi6Y7qwPeY5d0Us8uDQHnoNlzdkyJMc1ypEmUa86+nvJGIP5c8TZ6xXsmqOFhBt2aSs5LXg/+jK1hlj3Jgg5bAc/NnVsdTsCyrPE4wG5dkM=
services:
- docker
install: docker-compose run web rails db:setup
before_script:
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
script: docker-compose run web rspec
after_script:
- "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
# before_deploy:
# - docker-compose -f docker-compose.yml -f docker-compose.production.yml build web
# - docker-compose -f docker-compose.yml -f docker-compose.production.yml build worker
# - curl https://cli-assets.heroku.com/install.sh | sh
# deploy:
# - provider: script
#   command:
#   - docker-compose -f docker-compose.yml -f docker-compose.production.yml push web
#   - docker-compose -f docker-compose.yml -f docker-compose.production.yml push worker
#   - heroku container:release web worker -a brotherly
#   on:
#     repo: waxpoetic/brotherly
#     tags: true
# - provider: script
#   command:
#   - docker tag registry.heroku.com/brotherly/web registry.heroku.com/brotherly-staging/web
#   - docker tag registry.heroku.com/brotherly/worker registry.heroku.com/brotherly-staging/worker
#   - docker push registry.heroku.com/brotherly-staging/web
#   - docker push registry.heroku.com/brotherly-staging/worker
#   - heroku container:release web worker -a brotherly-staging
#   on:
#     repo: waxpoetic/brotherly
#     branch: master
